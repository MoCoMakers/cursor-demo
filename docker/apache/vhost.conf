<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /usr/local/apache2/htdocs
    
    # Enable proxy
    ProxyRequests Off
    ProxyPreserveHost On
    
    # Proxy all requests to Flask application
    ProxyPass / http://app:5000/
    ProxyPassReverse / http://app:5000/
    
    # Static files handling
    Alias /static /var/www/html/static
    <Directory "/var/www/html/static">
        Require all granted
        Options -Indexes
        AllowOverride None
    </Directory>
    
    # Health check endpoint
    <Location "/health">
        ProxyPass http://app:5000/health
        ProxyPassReverse http://app:5000/health
    </Location>
    
    # API endpoints
    <Location "/api">
        ProxyPass http://app:5000/api
        ProxyPassReverse http://app:5000/api
    </Location>
    
    # Error pages
    ErrorDocument 404 /404.html
    ErrorDocument 500 /500.html
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Logging
    LogLevel warn
    CustomLog /proc/self/fd/1 combined
    ErrorLog /proc/self/fd/2
</VirtualHost> 